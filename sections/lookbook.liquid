{% comment %}
  Lookbook Section
  Grid/masonry layout for showcasing collection images with GSAP animations
{% endcomment %}

{% liquid
  assign columns_desktop = section.settings.columns_desktop
  assign columns_mobile = section.settings.columns_mobile
  assign gap = section.settings.gap
  assign enable_overlay = section.settings.enable_overlay
%}

<div
  class="lookbook-section section section--{{ section.settings.section_width }} spacing-style color-{{ section.settings.color_scheme }}"
  style="{% render 'spacing-style', settings: section.settings %}"
  data-gsap-animation="fade-in"
>
  <div class="lookbook-container page-width">
    {% if section.settings.heading != blank %}
      <div class="lookbook-header" data-gsap-animation="fade-in">
        <h2 class="lookbook-heading {{ section.settings.heading_size }}">
          {{ section.settings.heading }}
        </h2>
        {% if section.settings.description != blank %}
          <div class="lookbook-description rte">
            {{ section.settings.description }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <div
      class="lookbook-grid lookbook-grid--{{ section.settings.layout_style }}"
      style="
        --lookbook-columns-desktop: {{ columns_desktop }};
        --lookbook-columns-mobile: {{ columns_mobile }};
        --lookbook-gap: {{ gap }}px;
      "
      data-gsap-animation="stagger"
    >
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'image' %}
            <div
              class="lookbook-item {% if block.settings.span_columns %}lookbook-item--span{% endif %}"
              {{ block.shopify_attributes }}
            >
              {% if block.settings.image != blank %}
                <div class="lookbook-image-wrapper">
                  {% assign sizes_value = '(min-width: 750px) calc(100vw / ' | append: columns_desktop | append: '), calc(100vw / ' | append: columns_mobile | append: ')' %}
                  {{
                    block.settings.image
                    | image_url: width: 1200
                    | image_tag: loading: "lazy", class: "lookbook-image", widths: "400, 600, 800, 1000, 1200", sizes: sizes_value
                  }}

                  {% if enable_overlay and block.settings.overlay_text != blank %}
                    <div class="lookbook-overlay backdrop-content">
                      <div class="lookbook-overlay-content">
                        {% if block.settings.overlay_text != blank %}
                          <p class="lookbook-overlay-text">{{ block.settings.overlay_text }}</p>
                        {% endif %}
                        {% if block.settings.link != blank %}
                          <a href="{{ block.settings.link }}" class="glass-button lookbook-overlay-button">
                            {{ block.settings.link_text | default: 'Shop Now' }}
                          </a>
                        {% endif %}
                      </div>
                    </div>
                  {% endif %}

                  {% if block.settings.link != blank and enable_overlay == false %}
                    <a href="{{ block.settings.link }}" class="lookbook-link" aria-label="{{ block.settings.overlay_text }}"></a>
                  {% endif %}
                </div>
              {% else %}
                <div class="lookbook-placeholder">
                  {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                </div>
              {% endif %}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

{% stylesheet %}
  .lookbook-section {
    position: relative;
  }

  .lookbook-container {
    width: 100%;
  }

  .lookbook-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .lookbook-heading {
    margin-bottom: 1rem;
  }

  .lookbook-description {
    max-width: 600px;
    margin: 0 auto;
    color: rgba(var(--color-foreground-rgb), 0.7);
  }

  .lookbook-grid {
    display: grid;
    grid-template-columns: repeat(var(--lookbook-columns-mobile), 1fr);
    gap: var(--lookbook-gap);
    width: 100%;
  }

  @media screen and (min-width: 750px) {
    .lookbook-grid {
      grid-template-columns: repeat(var(--lookbook-columns-desktop), 1fr);
    }
  }

  .lookbook-grid--masonry {
    grid-auto-rows: 250px;
  }

  .lookbook-item {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    background: var(--color-background);
  }

  .lookbook-item--span {
    grid-column: span 1;
  }

  @media screen and (min-width: 750px) {
    .lookbook-grid--masonry .lookbook-item:nth-child(3n+1) {
      grid-row: span 2;
    }

    .lookbook-item--span {
      grid-column: span 2;
    }
  }

  .lookbook-image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .lookbook-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
  }

  .lookbook-item:hover .lookbook-image {
    transform: scale(1.05);
  }

  .lookbook-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 1;
  }

  .lookbook-item:hover .lookbook-overlay {
    opacity: 1;
  }

  .lookbook-overlay-content {
    text-align: center;
    padding: 2rem;
  }

  .lookbook-overlay-text {
    color: var(--color-foreground);
    font-size: 1.2rem;
    margin-bottom: 1rem;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  }

  .lookbook-overlay-button {
    display: inline-block;
    text-decoration: none;
  }

  .lookbook-link {
    position: absolute;
    inset: 0;
    z-index: 1;
  }

  .lookbook-placeholder {
    width: 100%;
    height: 100%;
    min-height: 250px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(var(--color-foreground-rgb), 0.05);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Lookbook",
  "tag": "section",
  "class": "lookbook-wrapper section-wrapper",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Lookbook"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        { "value": "h3", "label": "Small" },
        { "value": "h2", "label": "Medium" },
        { "value": "h1", "label": "Large" }
      ],
      "default": "h2"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout style",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "masonry", "label": "Masonry" }
      ],
      "default": "masonry"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns (desktop)",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns (mobile)",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Gap between images",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "enable_overlay",
      "label": "Enable overlay on hover",
      "default": true
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section width",
      "options": [
        { "value": "page-width", "label": "Page width" },
        { "value": "full-width", "label": "Full width" }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "checkbox",
          "id": "span_columns",
          "label": "Span 2 columns",
          "default": false,
          "info": "Only works on desktop with grid layout"
        },
        {
          "type": "text",
          "id": "overlay_text",
          "label": "Overlay text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "default": "Shop Now"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Lookbook",
      "blocks": [
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}

